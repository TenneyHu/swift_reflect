# Visualiser Documentation

This script provides an interactive command-line interface to visualize and analyze logs generated by the 'reflect_summary' and 'reflect_prevk' algorithms.

## Setup
1.  Make sure you have the required libraries: pydantic, Pillow, termcolor.
    ```bash
    pip install pydantic Pillow termcolor
    ```
2.  Run your algorithms to generate `logs/reflect_summary.log` and/or `logs/reflect_prevk.log`.
3.  Run this script from the project's root directory:
    ```bash
    python cachesaver/visualiser.py
    ```

The script will automatically load all runs from both log files if they exist.

## Concepts

The visualiser has a three-level hierarchy for navigation:
1.  **Context Level**: This is the top level where you can switch between `reflect_summary` and `reflect_prevk` log files. The prompt shows the current context (e.g., `(reflect_summary) >>>`).
2.  **Task Level**: Within a context, you can see all the tasks (e.g., 'humaneval', 'hotpotqa') that have been logged. After opening a task, the prompt will look like `(reflect_summary)/hotpotqa >>>`.
3.  **Puzzle Level**: Within a task, you can open a specific puzzle to inspect its state flow and generate diagrams.

## Commands

-   `ls`:
    -   At the **Context Level**, this command lists all available tasks found in the log files.
    -   At the **Task Level**, this command lists all puzzles for the currently selected task and their final status (Won/Failed).

-   `cd <name>`:
    -   At the **Context Level**, use `open <task_name>` to select a task. Replace `<task_name>` with a name from the `ls` command (e.g., `open hotpotqa`).
    -   At the **Task Level**, use `open <puzzle_idx>` to select a puzzle. Replace `<puzzle_idx>` with a number from the `ls` command (e.g., `open 0`).

-   `cd ..`:
    Navigates one level up in the hierarchy.
    -   From a puzzle, it goes back to the list of puzzles within the task.
    -   From a task, it goes back to the list of tasks (the context level).

-   `img`:
    *This command can only be used at the **Puzzle Level**.*
    Generates a PNG image diagram for the currently opened puzzle. The image shows the flow of states through the agent over timesteps. The image will be saved in `tmp/<context_name>/<task_name>/pic_<puzzle_idx>.png`.
    **Example:** `img`

-   `s<id>` or `s<id>.<attribute>`:
    *This command can only be used at the **Puzzle Level**.*
    Inspects a state from the current puzzle. Replace `<id>` with the state number (e.g., s1, s2).
    -   `s<id>`: Prints the entire state object.
    -   `s<id>.<attribute>`: Prints a specific attribute of the state.
    -   **Shortcuts**:
        -   `cs`: `current_state`
        -   `sd`: `serial_data` (to access fields from the original state dictionary)
    -   **Examples**:
        -   `s1`: Prints the whole state object for state s1.
        -   `s1.num_thoughts`: Prints the number of thoughts for state s1.
        -   `s1.sd.puzzle`: Prints the 'puzzle' field from the `serial_data` of state s1.

-   `switch`:
    Switches between the `reflect_summary` and `reflect_prevk` log contexts if both are loaded. This will take you back to the top context level.

-   `compare`:
    Shows a side-by-side comparison of puzzle statuses (Won/Failed/Not found) for each task between the `reflect_summary` and `reflect_prevk` logs.

-   `clear`:
    Clears the terminal screen.

-   `q`:
    Quits the visualiser. 